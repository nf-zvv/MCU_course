# EEPROM

## Цель

Познакомиться с работой EEPROM микроконтроллера.

## Оборудование

1. Миниблок микроконтроллера ATmega16
2. Два вспомогательных миниблока с семисегментным светодиодным индикатором
3. Провода соединительные
4. Кабель USB - miniUSB
5. Блок БИЦУ (наборное поле с источником питания)
6. ПК с ОС GNU/Linux Ubuntu

## Теоретические сведения

Большинство МК AVR от Atmel содержат EEPROM (Electronically Erasable Read-Only Memory)   — энергонезависимую   память   с   довольно   большим количеством циклов записи. Данные, записанные в эту память, не будут сбрасываться даже при отключении питания, что очень удобно, например, для хранения настроек или каких-то идентификационных данных.

EEPROM в ATmega128RFA1 имеет ограниченное количество циклов записи — 20 000. Количество циклов чтения не ограничено.

Доступ к EEPROM в AVR можно получить с помощью специальных регистров, которые отвечают за адрес, информацию для записи (или прочитанную информацию) и совершаемое действие   (запись/чтение).

AVRLibC (обычно она входит в состав компилятора AVR-GCC) содержит готовую библиотеку для работы с EEPROM. Чтобы ее использовать, нужно подключить следующий заголовочный файл:

```C
#include <avr/eeprom.h>
```

В этой библиотеке для чтения и записи доступны три основных типа данных: byte (1 байт), word (2 байта) и блок данных. Для каждого типа есть своя функция записи и чтения: 

```C
// Читаем / пишем по одному байту (byte)
uint8_t eeprom_read_byte (const uint8_t *addr) 
void eeprom_write_byte (uint8_t *addr, uint8_t value) 

// Читаем / пишем по два байта (word)
uint16_t eeprom_read_word (const uint16_t *addr) 
void eeprom_write_word (uint16_t *addr, uint16_t value) 

// Читаем / пишем блоками
void eeprom_read_block (void *pointer_ram, const void *pointer_eeprom, size_t n) 
void eeprom_write_block (const void *pointer_ram, void *pointer_eeprom, size_t n)
```

> [!NOTE]  
> Перед записью в EEPROM следует запретить все прерывания, а после выполнения операции, разрешить.



## Ход работы

## Задания для самостоятельной работы

1. Усовершенствовать проект «Бинарные часы» из практической работы № 2: запоминать время на каждом шаге и восстанавливать счет с прежнего значения после отключания/включения питания.
2. Усовершенствовать проект «Переключатель» из  практической работы № 2: запоминать   состояние включенных светодиодов и восстанавливаться с прежнего состояния после отключания/включения питания. Добавить запрет записи нового значения, если оно не отличается от существующего.
3. Усовершенствовать проект  «Переключатель режимов» из практической работы  № 2: запоминать включанный режим и восстанавливать состояние после отключания/включения питания. Добавить  запрет записи нового значения, если оно не отличается от существующего.

## Содержание отчета

1. Титульный лист
2. Цель, задание на лабораторную работу
3. Электрическая схема
4. Алгоритм работы
5. Заключение
6. Приложения

## Контрольные вопросы

1. Назовите границы адресного пространства EEPROM Atmega128RFA1?
2. Какое количество циклов перезаписи EEPROM доступно?
3. Какие   регистры   отвечают   за   работу   с   энергонезависимой   памятью Atmega128RFA1?
4. Опишите алгоритм записи данных в EEPROM?
